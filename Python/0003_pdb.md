# 0003 pdb

## 简介

pdb是一个Python调试工具.相当于C的gdb.

这个工具已经集成在Python中所以不需要额外安装.

## 交互式调试

在使用pdb调试的时候,一般使用交互式调试模式.pdb自己有一个小shell(不同于bash,python交互式环境或者ipython).它的提示符是"(pdb)".

当程序运行到断点停下后就可以进入pdb的shell,通过命令可以查看或者改变一些变量的值,查看断点附近源码,继续运行等.

## 源码调用

可以直接在源码中调用pdb模块.来完成一些调试功能.例如这段代码:

```python
import pdb

x = 3
y = 5
pdb.set_trace()
y = x+y
```

当运行到`pdb.set_trace()`的时候就会暂停程序运行.然后启动pdb的调试shell.

## 调试模式启动

如果在命令行中使用pdb而非python启动脚本.就会以调试模式启动(直接进入pdb的shell).这种情况下相当于你把`pdb.set_trace()`放到了代码一开头执行.

## 调试命令

在pdb的shell中使用输入'h'可以获取帮助.

输入'q'可以退出调试(如果是在python或者ipython中启动的pdb,退出pdb就会继续执行代码).

## 断点和执行

对于调试来说最重要的功能就是断点,单步执行,查看变量当前的值,查看断点附近代码.

在pdb中输入'b',然后空格,然后接行号就能在制定行设置断点.用'tbreak'取代'b'就是设置临时断点.临时断点在停止一次后自动删除.(后续的命令后边加参数都要用空格隔开,不在赘述.)

每个断点设置之后都会显示编号.使用'cl'后加断点编号可以删除断点.

命令'c'继续执行代码.

命令's'执行一步代码(单步执行).与之类似的还有一个'n'命令.二者差异详见官方文档.

## 查看信息

使用'l'查看断点附近代码.

使用'll'查看整个frame中的代码.(至于什么是调试中的'frame',参见官方文档.一般的来说就是包含当前断点的代码块.比如在函数内断点,最内层的frame就是函数定义中的代码块.)

使用'u'返回上一层frame(代码块外部的代码块).比如断点在一个函数定义内,使用'u'就到了包含这个函数定义的class或者外层函数里.

使用'd'往'u'相反的方向移动.

使用'p'后加变量名,可以打印变量的值.

使用'w'查看断点所在的文件路径和文件内位置.

## 临时改变变量

在pdb的shell里可以使用赋值语句临时改变变量的值.如果变量正好和一些调试命令重名,可以在行首加'!',显式声明这是一个给变量赋值的语句.

更多的功能和命令详见官方文档.

## 和IPython互动

在IPython中的这个magic command可以在执行时立即启动调试

```IPython
%debug
```

使用命令'%pdb'可以开启或者关闭遇到异常时自动启动pdb调试的功能.如果不知道默认是开启还是关闭,就可以显式指定:

```IPython
%pdb on
```

这条命令表示打开遇到异常时自动启动pdb的功能.

## 资料

[官方文档](https://docs.python.org/3/library/pdb.html)